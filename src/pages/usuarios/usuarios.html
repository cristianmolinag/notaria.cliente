<ion-content padding>

  <div padding>
    <ion-segment [(ngModel)]="segmento">
      <ion-segment-button value="perfiles">
        Perfiles
      </ion-segment-button>
      <ion-segment-button value="roles">
        Roles
      </ion-segment-button>
      <ion-segment-button value="funcionarios">
        Funcionarios
      </ion-segment-button>
      <ion-segment-button value="clientes">
        Clientes
      </ion-segment-button>
      <ion-segment-button value="asignar_permisos">
        Asignar permisos
      </ion-segment-button>
    </ion-segment>
  </div>

  <div [ngSwitch]="segmento">

    <ion-list *ngSwitchCase="'perfiles'">
      <ion-item>
        <ion-card>
          <ion-item>
            <h2>Perfil</h2>
            <p>Listado de perfiles</p>
          </ion-item>
          <ion-item *ngFor="let item of perfiles">
            <p>{{ item.nombre }}</p>
          </ion-item>
        </ion-card>
      </ion-item>
    </ion-list>

    <ion-list *ngSwitchCase="'roles'">
      <ion-item>
        <ion-card>
          <ion-item>
            <h2>Rol</h2>
            <p>Listado de roles</p>
          </ion-item>
          <ion-item *ngFor="let item of roles">
            <p>{{ item.nombre }}</p>
          </ion-item>
        </ion-card>
      </ion-item>
    </ion-list>

    <ion-list *ngSwitchCase="'funcionarios'">
      <ion-item>
        <button ion-button icon-start outline (click)="guardarFuncionario()">
          <ion-icon name="create"></ion-icon>
          Nuevo funcionario
        </button>
      </ion-item>
      <ion-card *ngFor="let item of funcionarios">
        <ion-item>
          <h2>{{ item.nombres }} {{ item.apellidos }}</h2>
        </ion-item>
        <ion-item>
          <p>
            <strong>Correo:</strong>{{ item.correo }}</p>
        </ion-item>
        <ion-item>
          <p>
            <strong>Firma:</strong>
          </p>
          <img [src]="item.firma.firma" alt="firma" style="width:100px;">
        </ion-item>
        <ion-item>
          <button ion-button block (click)="guardarFuncionario(item)">Editar</button>
        </ion-item>
      </ion-card>
    </ion-list>

    <ion-list *ngSwitchCase="'clientes'">

      <ion-item>
        <button ion-button icon-start outline (click)="guardarCliente()">
          <ion-icon name="create"></ion-icon>
          Nuevo cliente
        </button>
      </ion-item>
      <ion-card *ngFor="let item of clientes">
        <ion-item>
          <h2>{{ item.nombres }} {{ item.apellidos }}</h2>
        </ion-item>
        <ion-item>
          <p>
            <strong>Correo:</strong>{{ item.correo }}</p>
        </ion-item>
        <ion-item>
          <button ion-button block (click)="guardarCliente(item)">Editar</button>
        </ion-item>
      </ion-card>
    </ion-list>

    <ion-list *ngSwitchCase="'asignar_permisos'">

      <h4>Administrar permisos</h4>
      <form [formGroup]="frmPermiso" (ngSubmit)="admPermiso()">
        <ion-grid>
          <ion-row>
            <ion-col>
              <ion-item>
                <ion-label stacked>Rol</ion-label>
                <ion-select formControlName="rol_id">
                  <ion-option *ngFor="let rol of roles" [value]="rol.id">{{ rol.nombre }}</ion-option>
                </ion-select>
              </ion-item>
            </ion-col>
            <ion-col>
              <ion-item>
                <ion-label stacked>Permiso</ion-label>
                <ion-select formControlName="permiso_id">
                  <ion-option *ngFor="let permiso of permisos" [value]="permiso.id">{{ permiso.titulo }}</ion-option>
                </ion-select>
              </ion-item>
            </ion-col>
            <ion-col>
              <ion-item no-lines>
                <button ion-button block color="primary" type="submit">Asignar</button>
              </ion-item>
            </ion-col>
            <ion-col>
              <ion-item no-lines>
                <button ion-button block color="danger" type="submit">Eliminar</button>
              </ion-item>
            </ion-col>
          </ion-row>
        </ion-grid>
      </form>

      <!-- Validacion de campos para administrar permisos-->
      <div *ngIf="frmPermiso.controls['rol_id'].touched && !frmPermiso.controls['rol_id'].valid">
        <small color="danger" ion-text *ngIf="frmPermiso.controls['rol_id'].hasError('required') ">
          El rol es requerido
        </small>
      </div>

      <div *ngIf="frmPermiso.controls['permiso_id'].touched && !frmPermiso.controls['permiso_id'].valid">
        <small color="danger" ion-text *ngIf="frmPermiso.controls['permiso_id'].hasError('required') ">
          El permiso es requerido
        </small>
      </div>

      <ion-item>
        <ion-card *ngFor="let permiso of rolesPorPermiso">
          <ion-item>
            <h2>
              <strong>Permiso</strong>
              {{ permiso.titulo }}
            </h2>
          </ion-item>
          <ion-item *ngFor="let rol of permiso.roles">
            <p>
              <strong>Rol: </strong>
              {{ rol.nombre }}
            </p>
          </ion-item>
        </ion-card>
      </ion-item>

    </ion-list>

  </div>
</ion-content>